<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">

  <!--full calendar node_modues-->
  <link href="/node_modules/fullcalendar/main.min.css" rel="stylesheet" />
  <script src="/node_modules/fullcalendar/main.min.js"></script>
  <script src="/node_modules/fullcalendar/locales/ko.js"></script> <!--한글설정-->
  <!--full calendar node_modues END-->

  <style>
  /*내 css*/
  #calendar-container{
    width: 1130px auto;
    margin: 100px 150px; 
  }
  </style>

<title>일정</title>

</head>

<body>
<script src="/node_modules/jquery/dist/jquery.min.js"></script>
<script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

<!--공통헤더 제이쿼리-->
<script type="text/javascript">
  $(document).ready(function () {
      $('#headers').load('/junho/mainHeader.html'); //헤더 인클루드
      $('#top').load('/ssang/groupBoard/none-search-top.html'); //상준님헤더
      // $('#footers').load('../html'); //푸터부분 인클루드
  });
</script>

<!--공통헤더-->
<div id="headers"></div>
<!--상준님 헤더-->
<div id="top"></div>

<!--캘린더 API 자리-->
<div id="calendar-container">
  <div id='calendar'></div>
</div>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
    height: '700px', // calendar 높이 설정  
    expandRows: true, // 화면에 맞게 높이 재설정
    timeZone: 'UTC',
    initialView: 'dayGridMonth', //월만 보이게함
    editable: true, // false로 변경 시 draggable 작동 x 
    displayEventTime: false, // 시간 표시 x
    headerToolbar: {center: 'addEventButton'}, // headerToolbar에 버튼을 추가
    eventClick: function(info) { //날짜를 클릭하면 나오는 이벤트
    var eventObj = info.event;
        if (eventObj.url) { //url이 있다면 새 탭으로 url을 연결한다.
            alert(
            'Clicked ' + eventObj.title + '.\n' +
            'Will open ' + eventObj.url + ' in a new tab'
            );
            window.open(eventObj.url);
            info.jsEvent.preventDefault(); // 현재 탭에서 url이 열리는 것을 막는다.
        } else { //url이 없는 일반 일정일 경우 내용 가져온 것을 보여주면 된다.
            // alert('Clicked ' + eventObj.title);
            $("#view-Modal").modal("show"); //상세보기 모달창 나타냄
            }
        }
    , customButtons: {
        addEventButton: { // 일정 추가 버튼 설정
            text : "일정 추가",  // 버튼 내용
            click : function(){ // 버튼 클릭 시 이벤트 추가
                $("#calendarModal").modal("show"); // modal 나타내기
                $("#x-addCalendar").on("click",function(){  // modal의 추가 버튼 클릭 시
                    var content = $("#calendar_content").val();
                    var start_date = $("#calendar_start_date").val();
                    var end_date = $("#calendar_end_date").val();
                    
                    //내용 입력 여부 확인
                    if(content == null || content == ""){
                        alert("내용을 입력하세요.");
                    }else if(start_date == "" || end_date ==""){
                        alert("날짜를 입력하세요.");
                    }else if(new Date(end_date)- new Date(start_date) < 0){ // date 타입으로 변경 후 확인
                        alert("종료일이 시작일보다 먼저입니다.");
                    }else{ // 정상적인 입력 시 
                        //ajax로 add 시키는 코드 필요
                        calendar.addEvent({ //캘린더에 출력됨
                            "title" : content,
                            "start" : start_date,
                            "end" : end_date
                        });                                
                        //전송할 객체 생성
                        console.log(obj);
                        
                    }
                });
            }
        }
    },
    events: function(info, successCallback, failureCallback) {
        $.ajax({
            url: '/calendar/list',
            type: 'POST',
            success: function(param) {   
            var events = [];     
            console.log(param);
            $.each(param, function(index, data){
                events.push({
                    id : data.no,
                    title : data.name,
                    start : data.startDt,
                    end : data.endDt,
                })
            }) //each END
            successCallback(events);
        }// success end
    }) //캘린더 리스트 불러오는ajax 끝
    }     
        


    }); //var calendar End
    calendar.render(); // 달력 출력
  }); //document.addEventListener End
</script>

<!--일정관리 추가 눌렀을 때 모달창-->
<div class="modal fade" id="calendarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">일정을 입력하세요.</h5>
              <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button> -->
          </div>
          <div class="modal-body">
              <div class="form-group">
                  <label for="taskId" class="col-form-label">일정 내용</label>
                  <input type="text" class="form-control" id="calendar_content" name="calendar_content">
                  <label for="taskId" class="col-form-label">시작 날짜</label>
                  <input type="date" class="form-control" id="calendar_start_date" name="calendar_start_date">
                  <label for="taskId" class="col-form-label">종료 날짜</label>
                  <input type="date" class="form-control" id="calendar_end_date" name="calendar_end_date">
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" id="x-addCalendar">추가</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal"
                  id="x-cancle-btn">닫기</button>
          </div>
      </div>
  </div>
</div>

<script>
//일정관리 - 추가 버튼 모달창 닫기
  // document.querySelector("#x-cancle-btn").onclick
  $("#x-cancle-btn").click(function(){
    $("#calendarModal").modal("hide");
  }); 
</script>

<!--상세보기 모달창-->

    <div class="modal" id="view-Modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="view-modal-title"></h5> <!--모임 title들어감-->
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <input id="" type="text">
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
        </div>
        </div>
    </div>
    </div>





</body>
</html>