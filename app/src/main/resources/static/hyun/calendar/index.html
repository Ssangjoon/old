<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
  <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">

  <!--full calendar 시작-->
  <link href="/node_modules/fullcalendar/main.css" rel="stylesheet" />
  <script src="/node_modules/fullcalendar/main.min.js"></script>
  <script src="/node_modules/@fullcalendar/daygrid/main.js"></script>
  <script src ="/node_modules/@fullcalendar/interaction/main.js"></script>
  <script src="/node_modules/fullcalendar/locales/ko.js"></script> <!--한글설정-->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth'
      });
      calendar.render();
    });
  </script>
  <!--full calendar 끝-->

  <style>
  /*내 css*/
  #calendar-container{
    width: 1130px auto;
    margin: 100px 150px; 
  }
  </style>
<title>일정</title>

</head>

<body>
<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

<!--공통헤더 제이쿼리-->
<script type="text/javascript">
  $(document).ready(function () {
      $('#headers').load('/junho/mainHeader.html'); //헤더 인클루드
      $('#top').load('/ssang/groupBoard/none-search-top.html'); //상준님헤더
      // $('#footers').load('../html'); //푸터부분 인클루드
  });
</script>

<!--공통헤더-->
<div id="headers"></div>
<!--상준님 헤더-->
<div id="top"></div>

<!--서버에서 약속 리스트 가져오기-->
<div>
<h1>캘린더</h1>
<table id="x-calendar-table" border="1">
<thead>
    <tr>
        <th>캘린더번호</th>
        <th>약속이름</th>
        <th>약속내용</th>
        <th>모임번호</th>
        <th>결과url</th>
        <th>시작날짜</th>
        <th>끝날짜</th>
    </tr>
</thead>
<tbody></tbody>
</table>
</div>
<script>
      var tbody = document.querySelector("#x-calendar-table tbody")
    //   console.log(tbody);

    fetch("/calendar/list")
    .then(function(response) {
        return response.json();
    })
    .then(function(calendars) {
        console.log(calendars);
        for(var calendar of calendars) {
            var tr = document.createElement("tr");
            tr.innerHTML = `<td>${calendar.no}</td>
            <td>${calendar.name}</td>
            <td>${calendar.content}</td>
            <td>${calendar.gno}</td>
            <td>${calendar.resulturl}</td>
            <td>${calendar.startDt}</td>
            <td>${calendar.endDt}</td>`;
            tbody.appendChild(tr);
        }
    });
</script>

<!--캘린더 API 자리-->
<div id="calendar-container">
  <div id='calendar'></div>
</div>

<!--캘린더-->
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
          timeZone: 'UTC',
          initialView: 'dayGridMonth', // 홈페이지에서 다른 형태의 view를 확인할  수 있다.
          events:[ // 일정 데이터 추가 , DB의 event를 가져오려면 JSON 형식으로 변환해 events에 넣어주면된다.
              {
                  title:'일정',
                  start:'2022-03-31 00:00:00',
                  end:'2022-04-01 24:00:00' 
                  // color 값을 추가해 색상도 변경 가능 자세한 내용은 하단의 사이트 참조
              },
              {
                  title:'일정2',
                  start:'2022-04-05 00:00:00',
                  end:'2022-04-05 24:00:00' 
                  // color 값을 추가해 색상도 변경 가능 자세한 내용은 하단의 사이트 참조
              }
          ], headerToolbar: {
              center: 'addEventButton' // headerToolbar에 버튼을 추가
          }, customButtons: {
              addEventButton: { // 추가한 버튼 설정
                  text : "일정 추가",  // 버튼 내용
                  click : function(){ // 버튼 클릭 시 이벤트 추가
                      $("#calendarModal").modal("show"); // modal 나타내기

                      $("#x-addCalendar").on("click",function(){  // modal의 추가 버튼 클릭 시
                          var content = $("#calendar_content").val();
                          var start_date = $("#calendar_start_date").val();
                          var end_date = $("#calendar_end_date").val();
                          
                          //내용 입력 여부 확인
                          if(content == null || content == ""){
                              alert("내용을 입력하세요.");
                          }else if(start_date == "" || end_date ==""){
                              alert("날짜를 입력하세요.");
                          }else if(new Date(end_date)- new Date(start_date) < 0){ // date 타입으로 변경 후 확인
                              alert("종료일이 시작일보다 먼저입니다.");
                          }else{ // 정상적인 입력 시
                              var obj = {
                                  "title" : content,
                                  "start" : start_date,
                                  "end" : end_date
                              }//전송할 객체 생성

                              console.log(obj); //서버로 해당 객체를 전달해서 DB 연동 가능
                          }
                      });
                  }
              }
          },
          editable: true, // false로 변경 시 draggable 작동 x 
          displayEventTime: false // 시간 표시 x
      });
      calendar.render();
  });
</script>


<!--일정관리 추가 눌렀을 때 모달창-->
<div class="modal fade" id="calendarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">일정을 입력하세요.</h5>
              <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button> -->
          </div>
          <div class="modal-body">
              <div class="form-group">
                  <label for="taskId" class="col-form-label">일정 내용</label>
                  <input type="text" class="form-control" id="calendar_content" name="calendar_content">
                  <label for="taskId" class="col-form-label">시작 날짜</label>
                  <input type="date" class="form-control" id="calendar_start_date" name="calendar_start_date">
                  <label for="taskId" class="col-form-label">종료 날짜</label>
                  <input type="date" class="form-control" id="calendar_end_date" name="calendar_end_date">
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" id="x-addCalendar">추가</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal"
                  id="x-cancle-btn">닫기</button>
          </div>
      </div>
  </div>
</div>

<script>//일정관리 - 추가 버튼 모달창 닫기
  // document.querySelector("#x-cancle-btn").onclick
  $("#x-cancle-btn").click(function(){
    $("#calendarModal").modal("hide");
  });  
</script>




</body>
</html>